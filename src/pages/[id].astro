---
import Layout from '../layouts/Layout.astro';

interface Forum {
  id: number;
  title: string;
  description: string;
  link: string;
  category: string;
}

interface Comment {
  forumId: number;
  user: string;
  profilePic: string;
  message: string;
  timestamp: string;
}

let dx : string = "dx";
let d : string = "d";

const forums: Forum[] = [
  { id: 1, title: 'Ayuda, no sé resolver este ejercicio de derivadas', description: 'En este ejercicio de derivadas me están pidiendo que encuentre la derivada de una función compleja y no estoy seguro de cómo empezar. He intentado aplicar la regla de la cadena, pero sigo teniendo dificultades con los pasos intermedios. ¿Alguien podría guiarme a través del proceso?', link: '/forums/ayuda-derivadas', category: 'Matemáticas' },
  { id: 2, title: 'Necesito ayuda con un problema de física', description: 'No entiendo cómo resolver este problema de física relacionado con el movimiento parabólico. El enunciado me pide calcular el alcance de un proyectil lanzado desde una altura determinada con una velocidad inicial específica. ¿Alguien puede explicar cómo utilizar las ecuaciones de movimiento para encontrar la solución?', link: '/forums/ayuda-fisica', category: 'Física' },
  { id: 3, title: 'Problemas con la programación en Python', description: 'Estoy teniendo dificultades para implementar este algoritmo en Python que recorre una lista de números y devuelve el mayor valor. He escrito algo de código, pero sigue arrojando errores y no sé cómo depurarlo. ¿Alguien podría revisar mi código y sugerirme correcciones?', link: '/forums/ayuda-python', category: 'Programación' },
  { id: 4, title: 'Cómo resolver esta ecuación diferencial', description: 'Estoy atrapado con esta ecuación diferencial de segundo orden. El problema me pide encontrar la solución general para una ecuación con coeficientes constantes, pero no estoy seguro de cómo aplicar el método de los coeficientes indeterminados. ¿Alguien puede ayudarme a entender los pasos necesarios?', link: '/forums/ayuda-ecuacion-diferencial', category: 'Matemáticas' },
  { id: 5, title: 'Necesito ayuda con este problema de termodinámica', description: 'No entiendo cómo aplicar la primera ley de la termodinámica en este problema. Me piden calcular el trabajo realizado por un gas durante una expansión isoterma, pero estoy confundido sobre cómo usar la ecuación del trabajo en procesos isotérmicos. ¿Alguien puede explicarlo con un ejemplo?', link: '/forums/ayuda-termodinamica', category: 'Física' },
  { id: 6, title: '¿Alguien puede explicarme la estructura de datos árboles?', description: 'Tengo problemas para entender cómo funcionan los árboles binarios. En particular, no estoy seguro de cómo implementar operaciones básicas como inserción, eliminación y recorrido en un árbol binario de búsqueda. ¿Alguien puede proporcionar una explicación clara y ejemplos de código en Python?', link: '/forums/ayuda-arboles-datos', category: 'Programación' },
  { id: 7, title: 'Ayuda con la interpretación de resultados estadísticos', description: 'No sé cómo interpretar los resultados de esta prueba estadística que he realizado para mi proyecto de investigación. He calculado valores p y estadísticas t, pero no estoy seguro de cómo determinar si mis resultados son significativos. ¿Alguien podría ayudarme a entender cómo interpretar estos valores?', link: '/forums/ayuda-estadisticas', category: 'Estadísticas' },
  { id: 8, title: 'Cómo mejorar mi gramática en inglés', description: 'Necesito consejos para mejorar mi gramática y redacción en inglés. A menudo cometo errores gramaticales en mis ensayos y correos electrónicos, y quiero aprender a escribir de manera más clara y correcta. ¿Alguien puede recomendarme recursos o ejercicios prácticos?', link: '/forums/ayuda-gramatica-ingles', category: 'Inglés' },
  { id: 9, title: 'Problemas para entender la fotosíntesis', description: 'Estoy confundido con las etapas de la fotosíntesis, especialmente la fase oscura. El material de mi libro de texto no es muy claro sobre cómo el ciclo de Calvin se relaciona con la conversión de dióxido de carbono en glucosa. ¿Alguien podría explicarlo de manera más sencilla?', link: '/forums/ayuda-fotosintesis', category: 'Biología' },
  { id: 10, title: 'Ayuda con la resolución de problemas de circuitos eléctricos', description: 'No sé cómo resolver este circuito con múltiples resistencias conectadas en serie y paralelo. Me piden calcular la resistencia total y la corriente que pasa por cada resistencia, pero estoy confundido sobre cómo aplicar las leyes de Ohm y Kirchhoff. ¿Alguien podría ayudarme a entender mejor estos conceptos?', link: '/forums/ayuda-circuitos-electricos', category: 'Física' },
  { id: 11, title: 'Cómo implementar un algoritmo de búsqueda binaria', description: 'Tengo problemas para entender cómo funciona la búsqueda binaria y cómo implementarla en un programa. Me piden buscar un número en una lista ordenada, pero no estoy seguro de cómo dividir el rango de búsqueda y comparar los valores. ¿Alguien puede explicar el algoritmo con un ejemplo en Python?', link: '/forums/ayuda-busqueda-binaria', category: 'Programación' },
  { id: 12, title: 'Dudas sobre la teoría de conjuntos', description: 'No entiendo cómo resolver estos ejercicios de teoría de conjuntos que implican operaciones como unión, intersección y diferencia. Me confundo especialmente con los diagramas de Venn y cómo representarlos. ¿Alguien podría proporcionar una explicación y ejemplos?', link: '/forums/ayuda-teoria-conjuntos', category: 'Matemáticas' },
  { id: 13, title: 'Necesito ayuda con la sintaxis de SQL', description: 'Tengo problemas para escribir consultas en SQL correctamente. Me piden crear una consulta que seleccione datos de varias tablas usando JOIN, pero sigo recibiendo errores de sintaxis. ¿Alguien podría revisar mi consulta y decirme qué estoy haciendo mal?', link: '/forums/ayuda-sql', category: 'Programación' },
  { id: 14, title: '¿Cómo aplicar la ley de gravitación universal?', description: 'No sé cómo usar la ley de gravitación universal para resolver este problema que involucra la fuerza entre dos masas. Estoy confundido sobre cómo aplicar la constante de gravitación y las distancias entre los objetos. ¿Alguien puede explicarlo con un ejemplo práctico?', link: '/forums/ayuda-gravitacion-universal', category: 'Física' },
  { id: 15, title: 'Ayuda con la traducción de un texto en inglés', description: 'No sé cómo traducir algunas frases complejas en este texto que estoy trabajando. Las estructuras gramaticales son complicadas y estoy teniendo dificultades para mantener el significado original. ¿Alguien con experiencia en traducción podría ayudarme?', link: '/forums/ayuda-traduccion-ingles', category: 'Inglés' },
  { id: 16, title: 'Dudas sobre el ciclo de Krebs', description: 'No entiendo bien las etapas del ciclo de Krebs y cómo se relacionan con la producción de ATP en las células. El libro de texto no es claro sobre las reacciones químicas involucradas y sus productos. ¿Alguien podría proporcionar una explicación detallada?', link: '/forums/ayuda-ciclo-krebs', category: 'Biología' },
  { id: 17, title: 'Cómo resolver integrales definidas', description: 'Estoy atascado en este ejercicio de integrales definidas que implica encontrar el área bajo una curva. He intentado usar la regla de Simpson, pero mis resultados no coinciden con los esperados. ¿Alguien puede mostrarme cómo resolverlo correctamente?', link: '/forums/ayuda-integrales-definidas', category: 'Matemáticas' },
  { id: 18, title: 'Necesito ayuda con este problema de química orgánica', description: 'No entiendo cómo hacer esta reacción orgánica que involucra la síntesis de un compuesto complejo. Me pierdo en los pasos intermedios y en cómo manipular los reactivos. ¿Alguien con experiencia en química orgánica podría guiarme a través del proceso?', link: '/forums/ayuda-quimica-organica', category: 'Química' },
  { id: 19, title: '¿Cómo mejorar mi pronunciación en inglés?', description: 'Necesito consejos para mejorar mi pronunciación en inglés, especialmente con los sonidos que no existen en mi lengua materna. ¿Alguien puede recomendarme ejercicios o recursos para practicar y mejorar?', link: '/forums/ayuda-pronunciacion-ingles', category: 'Inglés' },
  { id: 20, title: 'Ayuda con el análisis de algoritmos', description: 'Tengo problemas para entender cómo analizar la complejidad de los algoritmos que estoy estudiando. No estoy seguro de cómo determinar el tiempo de ejecución y la eficiencia de diferentes enfoques. ¿Alguien puede explicar estos conceptos con ejemplos claros?', link: '/forums/ayuda-analisis-algoritmos', category: 'Programación' }
];

const comments: Comment[] = [
  { forumId: 1, user: 'Juan Pérez', profilePic: 'https://randomuser.me/api/portraits/men/32.jpg', message: '¡Hola! Para resolver este ejercicio de derivadas, te recomiendo que empieces por aplicar la regla de la cadena. Identifica las funciones internas y externas y deriva paso a paso. Aquí tienes un ejemplo: Si tienes una función \\( f(g(x)) \\), la derivada es \\( f\'(g(x)) \\cdot g\'(x) \\). Por ejemplo, si \\( f(x) = (3x^2 + 2)^5 \\), entonces \\( g(x) = 3x^2 + 2 \\) y \\( f(u) = u^5 \\), y la derivada sería: \\[ \\frac{{d}}{{dx}} (3x^2 + 2)^5 = 5(3x^2 + 2)^4 \\cdot 6x \\]', timestamp: 'Hace 2 horas' },
  { forumId: 1, user: 'María Gómez', profilePic: 'https://randomuser.me/api/portraits/women/44.jpg', message: 'Además de la regla de la cadena, asegúrate de revisar tus pasos intermedios y comprobar cada derivada parcial.', timestamp: 'Hace 1 hora' },
  { forumId: 1, user: 'Carlos Ruiz', profilePic: 'https://randomuser.me/api/portraits/men/45.jpg', message: 'Un consejo adicional es practicar con diferentes funciones compuestas para familiarizarte con la técnica.', timestamp: 'Hace 30 minutos' },

  { forumId: 2, user: 'María Gómez', profilePic: 'https://randomuser.me/api/portraits/women/44.jpg', message: 'Para resolver el problema de física, primero debes identificar las variables conocidas y las incógnitas. Utiliza las ecuaciones de movimiento para encontrar la solución paso a paso.', timestamp: 'Hace 1 hora' },
  { forumId: 2, user: 'Luis Hernández', profilePic: 'https://randomuser.me/api/portraits/men/36.jpg', message: 'Recuerda también considerar la resistencia del aire si el problema lo indica.', timestamp: 'Hace 45 minutos' },

  { forumId: 3, user: 'Ana López', profilePic: 'https://randomuser.me/api/portraits/women/32.jpg', message: 'Para tu problema en Python, revisa tu lógica de bucle y asegúrate de que estás actualizando correctamente el valor máximo encontrado.', timestamp: 'Hace 3 horas' },
  { forumId: 3, user: 'José Martínez', profilePic: 'https://randomuser.me/api/portraits/men/50.jpg', message: 'Compartir tu código también ayudaría a identificar errores específicos.', timestamp: 'Hace 2 horas' },

  { forumId: 4, user: 'Laura Pérez', profilePic: 'https://randomuser.me/api/portraits/women/23.jpg', message: 'Para la ecuación diferencial, intenta usar el método de separación de variables. A veces simplifica mucho el problema.', timestamp: 'Hace 4 horas' },

  { forumId: 5, user: 'Miguel Torres', profilePic: 'https://randomuser.me/api/portraits/men/54.jpg', message: 'La primera ley de la termodinámica puede ser complicada. Asegúrate de tener claro qué es trabajo y qué es calor en tu problema.', timestamp: 'Hace 5 horas' },

  { forumId: 6, user: 'Carmen Diaz', profilePic: 'https://randomuser.me/api/portraits/women/12.jpg', message: 'Para los árboles binarios, una buena práctica es dibujar los pasos de inserción y eliminación.', timestamp: 'Hace 6 horas' },

  { forumId: 7, user: 'Fernando García', profilePic: 'https://randomuser.me/api/portraits/men/67.jpg', message: 'Para interpretar tus resultados estadísticos, asegúrate de entender bien los conceptos de p-valor y significancia estadística.', timestamp: 'Hace 7 horas' },

  { forumId: 8, user: 'Sofía López', profilePic: 'https://randomuser.me/api/portraits/women/20.jpg', message: 'Para mejorar tu gramática en inglés, recomiendo usar aplicaciones como Grammarly y practicar con ejercicios diarios.', timestamp: 'Hace 8 horas' },

  { forumId: 9, user: 'Andrés Pérez', profilePic: 'https://randomuser.me/api/portraits/men/33.jpg', message: 'La fase oscura de la fotosíntesis, o ciclo de Calvin, implica la fijación de carbono. Es importante entender cada paso del ciclo.', timestamp: 'Hace 9 horas' },

  { forumId: 10, user: 'Isabel Gómez', profilePic: 'https://randomuser.me/api/portraits/women/56.jpg', message: 'Para los circuitos eléctricos, intenta resolver primero las resistencias en serie y luego las paralelas.', timestamp: 'Hace 10 horas' },
  { forumId: 10, user: 'Ricardo Alvarez', profilePic: 'https://randomuser.me/api/portraits/men/43.jpg', message: 'Usar simulaciones en línea también puede ser muy útil para visualizar cómo funcionan los circuitos.', timestamp: 'Hace 9 horas' },

  { forumId: 11, user: 'Teresa Mendoza', profilePic: 'https://randomuser.me/api/portraits/women/25.jpg', message: 'Para la búsqueda binaria, asegúrate de dividir correctamente el rango de búsqueda y comparar los valores intermedios.', timestamp: 'Hace 1 hora' },

  { forumId: 12, user: 'Javier Ramírez', profilePic: 'https://randomuser.me/api/portraits/men/42.jpg', message: 'Para resolver ejercicios de teoría de conjuntos, usa diagramas de Venn para visualizar las operaciones de unión, intersección y diferencia.', timestamp: 'Hace 2 horas' },

  { forumId: 13, user: 'Sara Fernández', profilePic: 'https://randomuser.me/api/portraits/women/29.jpg', message: 'Asegúrate de usar las palabras clave correctas y revisar la sintaxis de tus consultas SQL.', timestamp: 'Hace 3 horas' },

  { forumId: 14, user: 'Tomás Gil', profilePic: 'https://randomuser.me/api/portraits/men/53.jpg', message: 'Para aplicar la ley de gravitación universal, usa la constante de gravitación y asegúrate de tener las distancias correctas entre las masas.', timestamp: 'Hace 4 horas' },

  { forumId: 15, user: 'Elena Cruz', profilePic: 'https://randomuser.me/api/portraits/women/34.jpg', message: 'Para traducir frases complejas, intenta descomponerlas en partes más simples y entender cada estructura gramatical.', timestamp: 'Hace 5 horas' },

  { forumId: 16, user: 'Carlos Santos', profilePic: 'https://randomuser.me/api/portraits/men/23.jpg', message: 'El ciclo de Krebs es fundamental para la producción de ATP. Entender cada etapa y las reacciones químicas es clave.', timestamp: 'Hace 6 horas' },

  { forumId: 17, user: 'Ana Morales', profilePic: 'https://randomuser.me/api/portraits/women/40.jpg', message: 'Para resolver integrales definidas, practica con diferentes métodos como la regla de Simpson y verifica tus resultados con ejemplos.', timestamp: 'Hace 7 horas' },

  { forumId: 18, user: 'Pedro Ortega', profilePic: 'https://randomuser.me/api/portraits/men/30.jpg', message: 'Para la síntesis de compuestos orgánicos, asegúrate de entender cada paso intermedio y los reactivos necesarios.', timestamp: 'Hace 8 horas' },

  { forumId: 19, user: 'Isabel Morales', profilePic: 'https://randomuser.me/api/portraits/women/41.jpg', message: 'Para mejorar tu pronunciación en inglés, practica con ejercicios específicos para los sonidos que no existen en tu lengua materna.', timestamp: 'Hace 9 horas' },

  { forumId: 20, user: 'Roberto Núñez', profilePic: 'https://randomuser.me/api/portraits/men/31.jpg', message: 'Para analizar algoritmos, es importante entender la complejidad temporal y espacial. Practica con ejemplos para identificar patrones de eficiencia.', timestamp: 'Hace 10 horas' }
];


function getForumById(id: number): Forum | undefined {
  return forums.find(forum => forum.id === id);
}

function getCommentsByForumId(forumId: number): Comment[] {
  return comments.filter(comment => comment.forumId === forumId);
}

export async function getStaticPaths() {
  return forums.map(forum => ({ params: { id: forum.id.toString() } }));
}

let showError = false;

function handleCommentSubmit() {
  showError = true;
}
const { id } = Astro.params;
const forumId = id ? parseInt(id, 10) : undefined;
const forum: Forum | undefined = forumId !== undefined ? getForumById(forumId) : undefined;
const forumComments: Comment[] = forumId !== undefined ? getCommentsByForumId(forumId) : [];
---
<script>
</script>

<Layout title={forum ? forum.title : 'Foro No Encontrado'}>
  {forum ? (
    <div>
      <div class="max-w-3xl mx-auto mt-8 p-6 rounded-lg shadow-md bg-gradient-to-r from-gray-800 via-gray-900 to-black text-white">
        <h1 class="text-3xl font-bold mb-4">{forum.title}</h1>
        <p class="text-gray-300 mb-4">{forum.description}</p>
        <a href={forum.link} class="text-blue-400 hover:text-blue-500 underline">Participar en el Foro</a>
      </div>

      <!-- Mensaje de error -->
      {showError && (
        <div class="max-w-3xl mx-auto mt-4 p-4 bg-red-100 text-red-700 rounded-lg">
          Necesitas iniciar sesión para dejar un comentario.
        </div>
      )}

      <!-- Tarjeta para añadir comentario -->
      <div class="max-w-3xl mx-auto mt-8 p-6 bg-white rounded-lg shadow-md">
        <h2 class="text-2xl font-bold mb-4">Añadir Comentario</h2>
        <div class="bg-gray-100 p-4 rounded-lg mb-4">
          <div class="flex items-center mb-4">
            <button class="text-gray-600 hover:text-gray-800 mx-2"><strong>B</strong></button>
            <button class="text-gray-600 hover:text-gray-800 mx-2"><em>I</em></button>
            <button class="text-gray-600 hover:text-gray-800 mx-2"><code>&lt;/&gt;</code></button>
            <button class="text-gray-600 hover:text-gray-800 mx-2">M</button>
          </div>
          <textarea class="w-full p-2 rounded-lg" rows="4" placeholder="Escribe tu comentario..."></textarea>
          <a href="/login" class="mt-4 inline-block px-4 py-2 bg-gradient-to-r from-gray-900 to-purple-900 text-white rounded-lg">Iniciar Sesión</a>
        </div>
      </div>

      <!-- Sección de comentarios y respuestas -->
      <div class="mt-8 max-w-3xl mx-auto p-6 bg-white rounded-lg shadow-md">
        <h2 class="text-2xl font-bold mb-4">Comentarios y Respuestas</h2>
        {forumComments.length > 0 ? (
          forumComments.map(comment => (
            <div class="flex items-start space-x-4 mb-4" key={comment.timestamp}>
              <img class="w-12 h-12 rounded-full" src={comment.profilePic} alt={`Perfil de ${comment.user}`} />
              <div class="flex-1">
                <div class="bg-gray-100 p-4 rounded-lg">
                  <p class="text-gray-700"><strong>{comment.user}:</strong> {comment.message}</p>
                </div>
                <div class="mt-2 text-sm text-gray-500">{comment.timestamp}</div>
              </div>
            </div>
          ))
        ) : (
          <p class="text-gray-500">No hay comentarios todavía.</p>
        )}
      </div>
    </div>
  ) : (
    <p class="text-red-500">Foro no encontrado.</p>
  )}
</Layout>